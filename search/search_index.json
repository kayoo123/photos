{"config":{"lang":["fr"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Pr\u00e9face","text":"<p>Info</p> <ul> <li><code>30/05/2024</code>: Initialisation du projet</li> </ul>"},{"location":"#ce-que-jessaye-de-faire","title":"Ce que j'essaye de faire...","text":"<p>Cherchant une solution efficace pour sauvegarder mes photos, je me lance dans ce petit projet afin de ne pas c\u00e9der aux douces sirenes des GAFAM.</p> <p>Apres un rapide tour d'horizon des outils libre, mon choix se porte naturellement vers Immich. </p> <p>Immich est une application libre et open-source con\u00e7ue pour la sauvegarde et la gestion de photos. Elle offre une alternative robuste et priv\u00e9e aux solutions commerciales propos\u00e9es par les g\u00e9ants de la tech.</p>"},{"location":"#mes-objectifs","title":"Mes objectifs","text":"<p>L'objectif principal est de mettre en place une solution de stockage de photos en ligne afin de :</p> <ul> <li>G\u00e9rer mes backups photos en mode 3-2-1 : avoir trois copies de mes donn\u00e9es, sur deux supports diff\u00e9rents, et une copie hors site.</li> <li>Avoir acc\u00e8s \u00e0 mes photos partout dans le monde.</li> <li>Partager facilement mes photos avec mes contacts.</li> </ul> <p>Ce qui sera au rendez-vous : </p> <ul> <li> la configuration d'un VPS</li> <li> la gestion de composant sous docker et docker-compose</li> <li> comment obtenir un DNS</li> <li> Gerer nos sauvegardes</li> <li> monter des volumes distants</li> <li> Supervision et alerting</li> <li> ...</li> <li> du MKdocs et du github workflow pour rendre jolie notre petite documentation</li> </ul> <p>Le but ici c'est d'apprendre tout en s'amusant et en partageant avec vous </p>"},{"location":"dns/","title":"Qu'est-ce qu'un DNS ?","text":"<p>DNS signifie Domain Name System (syst\u00e8me de noms de domaine). </p> <p>C'est un syst\u00e8me qui traduit les noms de domaine lisibles par l'homme (comme <code>www.exemple.com</code>) en adresses IP que les ordinateurs utilisent pour identifier les ressources sur le r\u00e9seau (comme <code>192.168.1.1</code>). </p> <p>En d'autres termes, le DNS agit comme un annuaire t\u00e9l\u00e9phonique pour Internet, permettant aux utilisateurs de se connecter aux sites Web en utilisant des noms de domaine faciles \u00e0 retenir plut\u00f4t que des adresses IP num\u00e9riques.</p>"},{"location":"dns/#quest-ce-que-freedns","title":"Qu'est-ce que freeDNS ?","text":"<p>freeDNS est un service de DNS gratuit qui permet aux utilisateurs de g\u00e9rer leurs propres enregistrements DNS sans frais. </p>"},{"location":"dns/#exemple-pour-mon-domaine-photosjeremifrto","title":"Exemple pour mon domaine : photos.jeremi.fr.to","text":"<p>Apres avoir valid\u00e9 mon inscription et m'y etre connect\u00e9, il suffit de se rendre sur : </p> <ul> <li>l'onglet: <code>Subdomains</code></li> <li>de cliquer sur <code>Add a new subdomain</code>, et de renseigner </li> <li>type : <code>A</code></li> <li>subdomain : <code>photos.jeremi</code></li> <li>domain: <code>fr.to (public)</code> (a chercher en cliquant sur 'many many more available &gt; Shared Domain Registry')</li> <li>destination: <code>45.149.206.155</code> (renseigner l'ip de votre machine virtuel)</li> <li>renseigner le captcha et valider avec <code>save</code>.</li> </ul> <p>Il nous reste a valider que la resolution fonctionne bien depuis n'importe quel ordinateur : </p> <pre><code>host photos.jeremi.fr.to\nphotos.jeremi.fr.to has address 45.149.206.155\n</code></pre> <p>Parfait :) A pr\u00e9sent, tous les ordinateurs du monde arrive \u00e0 ...</p> <p>En utilisant un service freeDNS, vous b\u00e9n\u00e9ficierez d'une gestion DNS efficace sans les co\u00fbts associ\u00e9s a ce type de services.</p>"},{"location":"init/fail2ban/","title":"Hardening (Fail2ban)","text":"<p>Fail2Ban est un logiciel de s\u00e9curit\u00e9 qui prot\u00e8ge votre serveur en surveillant les journaux de services pour d\u00e9tecter les tentatives de connexion \u00e9chou\u00e9es et en bloquant les adresses IP qui les effectuent. Cela permet de pr\u00e9venir les attaques par force brute et d'autres menaces similaires.</p>"},{"location":"init/fail2ban/#installation-de-fail2ban","title":"Installation de Fail2Ban","text":"<p>La premi\u00e8re \u00e9tape consiste \u00e0 installer Fail2Ban ainsi qu'iptables, qui sera utilis\u00e9 pour appliquer les r\u00e8gles de blocage.</p> <p>Ex\u00e9cutez les commandes suivantes pour mettre \u00e0 jour votre syst\u00e8me et installer Fail2Ban et iptables :</p> <pre><code>apt update &amp;&amp; apt install -y fail2ban iptables\n</code></pre>"},{"location":"init/fail2ban/#configuration-de-fail2ban","title":"Configuration de Fail2Ban","text":"<p>Pour que Fail2Ban puisse surveiller les journaux de connexion SSH votre serveur, nous devons cr\u00e9er les r\u00e9pertoires et fichiers n\u00e9cessaires. Dans cet exemple, nous configurons \u00e9galement Fail2Ban pour surveiller les journaux de Traefik (proxy-web).</p> <pre><code>mkdir /var/log/traefik/\ntouch /var/log/traefik/access.log\n</code></pre> <p>Nous allons maintenant cr\u00e9er deux fichiers de configuration personnalis\u00e9 pour Fail2Ban: </p>"},{"location":"init/fail2ban/#customconf-gere-le-comportement-du-service-fail2ban","title":"<code>custom.conf</code> : Gere le comportement du service fail2ban","text":"<pre><code>cat &lt;&lt;EOF &gt; /etc/fail2ban/jail.d/custom.conf\n[DEFAULT]\nignoreip = 127.0.0.1 $(hostname -I)\nfindtime = 20m\nbantime = 24h\nmaxretry = 2\n\n[sshd]\nbackend = systemd\nEOF\n</code></pre> <ul> <li><code>ignoreip</code> : Adresses IP \u00e0 ignorer par Fail2Ban (ajoutez l'adresse IP de votre serveur).</li> <li><code>findtime</code> : P\u00e9riode de recherche des tentatives de connexion \u00e9chou\u00e9es.</li> <li><code>bantime</code> : Dur\u00e9e du bannissement des IP en cas de tentatives \u00e9chou\u00e9es r\u00e9p\u00e9t\u00e9es.</li> <li><code>maxretry</code> : Nombre maximum de tentatives \u00e9chou\u00e9es avant de bannir une IP.</li> </ul>"},{"location":"init/fail2ban/#traefikconf-gestion-des-connexions-basic-auth-sur-vos-services","title":"<code>traefik.conf</code> : Gestion des connexions basic-auth sur vos services","text":"<pre><code>cat &lt;&lt;EOF &gt; /etc/fail2ban/jail.d/traefik.conf\n[traefik-auth]\nenabled = true\nchain = DOCKER-USER\nlogpath = /var/log/traefik/access.log\nport = http,https\nEOF\n</code></pre> <ul> <li><code>enabled</code> : Active la surveillance de Traefik.</li> <li><code>chain</code> : Cha\u00eene iptables o\u00f9 les r\u00e8gles de blocage seront appliqu\u00e9es.</li> <li><code>logpath</code> : Chemin vers le fichier de journalisation de Traefik.</li> <li><code>port</code> : Ports \u00e0 surveiller (HTTP et HTTPS).</li> </ul>"},{"location":"init/fail2ban/#activation-et-redemarrage-de-fail2ban","title":"Activation et Red\u00e9marrage de Fail2Ban","text":"<p>Pour appliquer les nouvelles configurations, red\u00e9marrez le service Fail2Ban et configurez-le pour qu'il se lance automatiquement au d\u00e9marrage du serveur :</p> <pre><code>systemctl restart fail2ban\nsystemctl enable fail2ban\nfail2ban-client status\n</code></pre>"},{"location":"init/fail2ban/#conclusion","title":"Conclusion","text":"<p>L'installation et la configuration de Fail2Ban ajoutent une couche de s\u00e9curit\u00e9 essentielle \u00e0 votre serveur en bloquant les adresses IP malveillantes. En suivant ces \u00e9tapes, vous prot\u00e9gez efficacement votre VPS contre les attaques par force brute et autres tentatives de connexion non autoris\u00e9es.</p>"},{"location":"init/pkg/","title":"Que faut-il installer","text":"<p>La premi\u00e8re chose \u00e0 faire est de mettre \u00e0 jour les paquets existants sur votre VPS.  Cela garantit que vous disposez des derni\u00e8res mises \u00e0 jour de s\u00e9curit\u00e9 et des am\u00e9liorations logicielles.</p>"},{"location":"init/pkg/#mise-a-jour-du-systeme","title":"Mise \u00e0 Jour du Syst\u00e8me","text":"<pre><code>apt update &amp;&amp; apt upgrade -y\n</code></pre>"},{"location":"init/pkg/#installation-des-paquets-essentiels","title":"Installation des Paquets Essentiels","text":"<p><pre><code>apt install -y sudo wget git vim apt-transport-https ca-certificates curl gnupg net-tools jq\napt autoremove -y\n</code></pre> Voici une br\u00e8ve description de chacun de ces paquets :</p> <ul> <li><code>sudo</code> : Permet \u00e0 un utilisateur d'ex\u00e9cuter des commandes en tant qu'un autre utilisateur, souvent l'utilisateur root.</li> <li><code>wget</code> : Utilitaire de t\u00e9l\u00e9chargement de fichiers depuis le web.</li> <li><code>git</code> : Syst\u00e8me de contr\u00f4le de version distribu\u00e9 pour g\u00e9rer le code source.</li> <li><code>vim</code> : \u00c9diteur de texte avanc\u00e9 pour modifier des fichiers de configuration et du code.</li> <li><code>apt-transport-https</code> : Permet \u00e0 apt de r\u00e9cup\u00e9rer des paquets via HTTPS.</li> <li><code>ca-certificates</code> : Paquets de certificats racine pour v\u00e9rifier les certificats SSL.</li> <li><code>curl</code> : Outil de ligne de commande pour transf\u00e9rer des donn\u00e9es avec des URL.</li> <li><code>gnupg</code> : Outil pour la gestion des cl\u00e9s et la s\u00e9curit\u00e9 des communications.</li> <li><code>net-tools</code> : Suite d'outils r\u00e9seau comme ifconfig et netstat.</li> <li><code>jq</code> : Utilitaire de manipulation de donn\u00e9es JSON.</li> </ul> <p>Ces \u00e9tapes de mise \u00e0 jour et d'installation des paquets sont essentielles pour assurer la s\u00e9curit\u00e9 et la fonctionnalit\u00e9 de votre VPS. En suivant ces commandes, vous pr\u00e9parez votre serveur pour les prochaines \u00e9tapes de configuration et de d\u00e9ploiement.</p>"},{"location":"init/provider/","title":"Quel fournisseur choisir","text":"<p>Pour commencer, nous devons d\u00e9cider vers quel fournisseur (provider) nous allons tourner notre machine virtuelle (VPS). Apr\u00e8s avoir \u00e9tudi\u00e9 plusieurs options, mon choix s'est port\u00e9 sur Contabo, qui propose une offre VPS tr\u00e8s int\u00e9ressante et comp\u00e9titive.</p>"},{"location":"init/provider/#choix-du-provider-contabo","title":"Choix du Provider : Contabo","text":""},{"location":"init/provider/#pourquoi-contabo","title":"Pourquoi Contabo ?","text":"<p>Contabo offre un excellent rapport qualit\u00e9/prix, ce qui en fait une option id\u00e9ale pour h\u00e9berger notre VPS. Voici les sp\u00e9cifications de l'offre que j'ai choisie :</p> <ul> <li>4 vCPU Cores : Quatre c\u0153urs de processeur virtuels pour des performances optimales.</li> <li>6 GB RAM : Une m\u00e9moire suffisante pour g\u00e9rer plusieurs t\u00e2ches simultan\u00e9ment sans ralentissement.</li> <li>600 GB SSD : Un espace de stockage SSD rapide et ample pour stocker nos donn\u00e9es et nos photos.</li> <li>1 Snapshot : Une sauvegarde instantan\u00e9e pour restaurer rapidement le syst\u00e8me en cas de probl\u00e8me.</li> <li>32 TB Traffic (Unlimited upload) : Une g\u00e9n\u00e9reuse allocation de bande passante pour garantir un acc\u00e8s fluide \u00e0 nos donn\u00e9es, m\u00eame en cas de forte utilisation.</li> </ul>"},{"location":"init/provider/#processus-dinscription","title":"Processus d'Inscription","text":"<p>Apr\u00e8s avoir choisi Contabo comme fournisseur, le processus d'inscription est simple : 1. Rendez-vous sur le site de Contabo et cr\u00e9ez un compte. 2. S\u00e9lectionnez l'offre VPS qui correspond \u00e0 vos besoins (comme celle d\u00e9crite ci-dessus). 3. Suivez les instructions pour finaliser votre inscription et configurer votre VPS.</p>"},{"location":"init/provider/#choix-de-limage-debian","title":"Choix de l'Image : Debian","text":""},{"location":"init/provider/#pourquoi-debian","title":"Pourquoi Debian ?","text":"<p>Une fois l'inscription termin\u00e9e, nous devons choisir une image de syst\u00e8me d'exploitation pour notre VPS. Familiaris\u00e9 avec les \u00e9cosyst\u00e8mes Linux, j'ai opt\u00e9 pour Debian en raison de ses avantages suivants :</p> <ul> <li>Stabilit\u00e9 : Debian est connu pour sa stabilit\u00e9 et sa fiabilit\u00e9, ce qui en fait un excellent choix pour un serveur.</li> <li>Support : Debian b\u00e9n\u00e9ficie d'un large support communautaire et de mises \u00e0 jour r\u00e9guli\u00e8res.</li> <li>S\u00e9curit\u00e9 : La distribution met un fort accent sur la s\u00e9curit\u00e9, avec des correctifs de s\u00e9curit\u00e9 rapides et efficaces.</li> </ul>"},{"location":"init/provider/#etapes-pour-selectionner-limage-debian","title":"\u00c9tapes pour S\u00e9lectionner l'Image Debian","text":"<ol> <li>Connexion \u00e0 votre compte Contabo : Une fois votre compte cr\u00e9\u00e9 et votre VPS configur\u00e9, connectez-vous \u00e0 votre tableau de bord Contabo.</li> <li>Choix de l'Image : Dans les options de configuration du VPS, s\u00e9lectionnez Debian comme syst\u00e8me d'exploitation.</li> <li>Version de Debian : Choisissez la version de Debian que vous pr\u00e9f\u00e9rez (la derni\u00e8re version stable est recommand\u00e9e pour b\u00e9n\u00e9ficier des derni\u00e8res am\u00e9liorations et correctifs de s\u00e9curit\u00e9).</li> <li>Finalisation : Confirmez votre choix et proc\u00e9dez \u00e0 l'installation de l'image Debian sur votre VPS.</li> <li>Patienter : le processus de creation du VPS est compris entre 5 et 30 minutes.</li> </ol>"},{"location":"init/provider/#conclusion","title":"Conclusion","text":"<p>En choisissant Contabo comme fournisseur de VPS et Debian comme syst\u00e8me d'exploitation, nous posons les bases d'une infrastructure robuste, stable et performante pour notre projet de sauvegarde de photos. Ces choix garantissent une exp\u00e9rience utilisateur fluide et s\u00e9curis\u00e9e, tout en offrant une grande flexibilit\u00e9 et des performances \u00e9lev\u00e9es.</p> <p>N'h\u00e9sitez pas \u00e0 consulter la documentation de Contabo et Debian pour plus de d\u00e9tails sur l'utilisation et la gestion de votre VPS.</p>"},{"location":"init/ssh/","title":"Gestion des utilisateurs et des connexions","text":"<p>Pour s\u00e9curiser et administrer efficacement notre VPS, il est essentiel de g\u00e9rer correctement les utilisateurs et de configurer SSH (Secure Shell). Cette section d\u00e9crit les \u00e9tapes n\u00e9cessaires pour ajouter un nouvel utilisateur avec des privil\u00e8ges sudo et pour configurer SSH afin d'am\u00e9liorer la s\u00e9curit\u00e9.</p>"},{"location":"init/ssh/#ajout-dun-nouvel-utilisateur","title":"Ajout d'un Nouvel Utilisateur","text":"<p>La premi\u00e8re \u00e9tape consiste \u00e0 ajouter un nouvel utilisateur qui sera utilis\u00e9 pour les connexions et les t\u00e2ches administratives.</p>"},{"location":"init/ssh/#commandes-pour-ajouter-un-utilisateur","title":"Commandes pour Ajouter un Utilisateur","text":"<p>Ex\u00e9cutez les commandes suivantes pour cr\u00e9er un nouvel utilisateur nomm\u00e9 <code>jeremi</code> pour l'exemple et avec les privil\u00e8ges n\u00e9cessaires :</p> <pre><code># Ajouter un nouvel utilisateur avec un home directory, un user ID sp\u00e9cifique, et des groupes users et sudo\nuseradd -m -u 1001 -G users,sudo -s /bin/bash jeremi\n\n# D\u00e9finir un mot de passe pour le nouvel utilisateur\npasswd jeremi\n\n# Ajouter une entr\u00e9e dans sudoers pour permettre \u00e0 l'utilisateur jeremi d'ex\u00e9cuter des commandes sudo sans mot de passe\necho \"jeremi ALL=(ALL) NOPASSWD:ALL\" | tee /etc/sudoers.d/jeremi\n</code></pre>"},{"location":"init/ssh/#configuration-de-ssh","title":"Configuration de SSH","text":"<p>Pour am\u00e9liorer la s\u00e9curit\u00e9 de notre serveur, nous allons configurer SSH pour d\u00e9sactiver les connexions root et restreindre l'acc\u00e8s SSH \u00e0 notre nouvel utilisateur.</p>"},{"location":"init/ssh/#commandes-pour-configurer-ssh","title":"Commandes pour Configurer SSH","text":"<p>Ex\u00e9cutez les commandes suivantes pour modifier la configuration SSH :</p> <pre><code># D\u00e9sactiver les connexions SSH root\nsed -i -r \"s/PermitRootLogin .*/PermitRootLogin no/g\" /etc/ssh/sshd_config\ngrep PermitRootLogin /etc/ssh/sshd_config\n\n# Ajouter une r\u00e8gle pour autoriser uniquement l'utilisateur jeremi \u00e0 se connecter via SSH\necho 'AllowUsers jeremi' | sudo tee -a /etc/ssh/sshd_config\n\n# N'oubliez pas de red\u00e9marrer le service SSH pour appliquer les modifications :\nsystemctl restart ssh\n</code></pre>"},{"location":"init/ssh/#optionnel-changement-du-port-ssh","title":"(Optionnel) Changement du Port SSH","text":"<p>Pour une s\u00e9curit\u00e9 suppl\u00e9mentaire, vous pouvez changer le port par d\u00e9faut utilis\u00e9 par SSH. D\u00e9commentez et modifiez la ligne suivante dans /etc/ssh/sshd_config :</p> <pre><code># Modification du port 22 par 1221\nsed -i -r \"s/#Port 22/Port 1221/g\" /etc/ssh/sshd_config\n\n# Gestion d'une regele iptables pour autoriser les connexions sur le nouveau port :\niptables -A INPUT -m state --state NEW -m tcp -p tcp --dport 1221 -j ACCEPT\n</code></pre>"},{"location":"init/ssh/#conclusion","title":"Conclusion","text":"<p>En suivant ces \u00e9tapes, vous configurez un environnement utilisateur s\u00e9curis\u00e9 et optimis\u00e9 pour l'administration de votre VPS. La gestion appropri\u00e9e des utilisateurs et la configuration de SSH sont des \u00e9l\u00e9ments cl\u00e9s pour maintenir la s\u00e9curit\u00e9 et l'int\u00e9grit\u00e9 de votre serveur.</p>"}]}